<div class="cart-container grid-container">
  <h2>Your Shopping Cart</h2>

  <div *ngIf="cartItems$ | async as items; else emptyCart">
    <div *ngIf="items.length > 0; else emptyCart">

      <div class="cart-items">
        <div *ngFor="let item of items" class="cart-item card">
          <img [src]="item.imageUrl || 'assets/images/placeholder-gelato.png'" [alt]="item.name" class="item-image">
          <div class="item-details">
            <h3>{{ item.name }}</h3>
            <p>Price: {{ item.price | currency:'PHP':'symbol':'1.2-2' }}</p>
            <div class="quantity-controls">
              <button class="btn btn-secondary btn-sm" (click)="updateQuantity(item, -1)">-</button>
              <span class="quantity">{{ item.quantity }}</span>
              <button class="btn btn-secondary btn-sm" (click)="updateQuantity(item, 1)">+</button>
            </div>
            <p class="item-subtotal">Subtotal: {{ item.price * item.quantity | currency:'PHP':'symbol':'1.2-2' }}</p>
          </div>
          <button class="btn btn-remove" (click)="removeItem(item.productId)">Ã—</button>
        </div>
      </div>

      <div class="cart-summary card">
        <h3>Summary</h3>
        <p>Total Items: {{ cartService.getTotalItemCount() }}</p>
        <p class="total-price">Total Price: {{ totalPrice | currency:'PHP':'symbol':'1.2-2' }}</p>
        <div class="cart-actions">
           <button class="btn btn-secondary" (click)="clearCart()">Clear Cart</button>
           <button class="btn btn-primary" routerLink="/checkout">Proceed to Checkout</button>
        </div>
      </div>

    </div>
  </div>

  <ng-template #emptyCart>
    <div class="card text-center">
      <p>Your cart is empty.</p>
      <button class="btn btn-primary" routerLink="/product">Browse Flavors</button>
    </div>
  </ng-template>
</div>